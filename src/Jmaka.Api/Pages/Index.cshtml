@page
@{
    Layout = null;
}
<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Jmaka</title>
  <link rel="stylesheet" href="~/app.css" asp-append-version="true" />
  <link rel="stylesheet" href="~/features/videoedit/style.css" asp-append-version="true" />
</head>
<body>
  <main class="page">
    <section class="uploader" aria-label="Загрузка файла">
      <!-- Left Panel -->
      <div class="left-panel">
        <!-- Logo at the top -->
        <div class="ascii-logo-container">
          <pre id="asciiArt" class="ascii-art"></pre>
          <span class="version-badge" data-version>v0.5.2</span>
        </div>

        <!-- Upload button and languages HORIZONTALLY -->
        <div class="upload-and-language">
          <!-- Upload button on the left -->
          <button class="save-btn" id="saveBtn" type="button" aria-label="Загрузить изображение">
            <div class="save-icon" aria-hidden="true">
              <svg class="save-arrow" viewBox="0 0 64 64" focusable="false">
                <path d="M32 8v22" fill="none" stroke="currentColor" stroke-width="6" stroke-linecap="round" />
                <path d="M20 24l12 12 12-12" fill="none" stroke="currentColor" stroke-width="6" stroke-linecap="round" stroke-linejoin="round" />
              </svg>
              <svg class="save-disk" viewBox="0 0 64 64" focusable="false">
                <path d="M10 8h34l10 10v38H10V8zm6 6v12h26V14H16zm0 20v16h32V34H16zm6-16h12v6H22v-6z" />
              </svg>
            </div>
            <div class="save-label">Загрузить изображение</div>
          </button>

          <!-- Language switcher on the right -->
          <div id="languageSwitcher" class="language-switcher" aria-label="Language selector">
            <button id="langRuBtn" class="lang-btn" type="button" data-lang="ru" aria-pressed="false">Русский</button>
            <button id="langEnBtn" class="lang-btn" type="button" data-lang="en-US" aria-pressed="false">English</button>
            <button id="langEsBtn" class="lang-btn" type="button" data-lang="es-ES" aria-pressed="false">Español</button>
          </div>
        </div>
      </div>

      <!-- Right Panel -->
      <div class="preview-wrap">
        <div class="main-controls" aria-label="Панель управления">
          <div class="tool-buttons" aria-label="Инструменты">
            <div class="tool-row">
              <button id="splitToolBtn" class="btn tool-btn" type="button">Split</button>
              <button id="split3ToolBtn" class="btn tool-btn" type="button">Split3</button>
              <button id="oknoFixToolBtn" class="btn tool-btn" type="button">OknoFix</button>
              <button id="oknoScaleToolBtn" class="btn tool-btn" type="button">OknoScale</button>
            </div>
            <div class="tool-row">
              <button id="cropToolBtn" class="btn tool-btn" type="button">Crop</button>
              <button id="imageEditToolBtn" class="btn tool-btn" type="button">Edit</button>
              <button id="videoEditToolBtn" class="btn tool-btn video-edit" type="button">Video Edit<span class="excl" aria-hidden="true">❗</span></button>
            </div>
          </div>

          <div id="sizeButtons" class="size-buttons" aria-label="Размеры">
            <button class="size-btn" type="button" data-w="2440" disabled>2440</button>
            <button class="size-btn" type="button" data-w="1920" disabled>1920</button>
            <button class="size-btn" type="button" data-w="1280" disabled>1280</button>
          </div>
        </div>

        <div id="hint" class="hint">Нажмите на дискету, перетащите файлы или вставьте из буфера обмена — и они загрузятся.</div>
        <button id="helpBtn" class="help-btn" type="button" aria-label="Справка">?</button>
      </div>

      <input id="fileInput" class="file-input" type="file" accept="image/*" multiple />
      <input id="videoInput" class="file-input" type="file" accept="video/*" hidden />
    </section>

    <div class="tables-wrap" aria-label="Таблицы файлов">
      <div class="links-wrap" aria-label="Таблица файлов">
        <div class="links-title">Original / Crop / Sizes</div>
        <div class="table-wrap">
          <table class="files-table" aria-label="Готовые файлы">
            <thead>
              <tr>
                <th class="col-dt">Дата - время</th>
                <th class="col-orig">Оригинал</th>
                <th class="col-crop">Crop</th>
                <th class="col-size">1280</th>
                <th class="col-size">1920</th>
                <th class="col-size">2440</th>
                <th class="col-del"></th>
              </tr>
            </thead>
            <tbody id="filesTbody"></tbody>
          </table>
        </div>
      </div>

      <div class="links-wrap composites-wrap" aria-label="Таблица Split">
      <div class="links-title">Split / Split3 / OknoFix / OknoScale / Edits</div>
        <div class="table-wrap">
          <table class="files-table" aria-label="Split / Split3">
            <thead>
              <tr>
                <th class="col-dt">Дата - время</th>
                <th class="col-kind">Тип</th>
                <th class="col-comp">Результат</th>
                <th class="col-del"></th>
              </tr>
            </thead>
            <tbody id="compositesTbody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <pre id="result" class="result" aria-label="Результат" hidden></pre>
    
    <footer style="text-align: center; padding: 10px; font-size: 11px; color: #64748b; opacity: 0.7;">
      Jmaka v<span data-version>0.5.2</span>
    </footer>
  </main>

  <!-- Модалка подтверждения удаления -->
  <div id="deleteModal" class="modal" hidden>
    <div class="modal-backdrop" data-close="1"></div>
    <div class="modal-card" role="dialog" aria-modal="true" aria-label="Удаление">
      <div class="modal-header">
        <div class="modal-title-wrap">
          <div class="modal-title">Удаление</div>
          <div class="modal-sub">
            <span class="modal-subtext">Удалить запись и все связанные файлы безвозвратно?</span>
          </div>
        </div>
        <button id="deleteClose" class="modal-x" type="button" aria-label="Закрыть">×</button>
      </div>
      <div class="modal-body">
        <label class="checkbox-row">
          <input id="deleteSkipConfirm" type="checkbox" />
          <span>Больше не спрашивать (удалять сразу)</span>
        </label>
      </div>
      <div class="modal-footer">
        <div class="modal-hint">Можно включить обратно, очистив настройку в LocalStorage.</div>
        <div class="modal-actions">
          <button id="deleteCancel" class="btn" type="button">Отмена</button>
          <button id="deleteConfirm" class="btn danger" type="button">Удалить</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Просмотр изображения -->
  <div id="viewerModal" class="modal" hidden>
    <div class="modal-backdrop" data-close="1"></div>
    <div class="modal-card viewer-card" role="dialog" aria-modal="true" aria-label="Просмотр изображения">
      <div class="modal-header">
        <div class="modal-title-wrap">
          <div class="modal-title">Просмотр</div>
          <div class="modal-sub">
            <span id="viewerLabel" class="modal-subtext"></span>
            <a id="viewerOpen" class="modal-sublink" href="#" target="_blank" rel="noreferrer" hidden>Открыть в новой вкладке</a>
          </div>
        </div>
        <button id="viewerClose" class="modal-x" type="button" aria-label="Закрыть">×</button>
      </div>
      <div class="modal-body viewer-body">
        <img id="viewerImg" class="viewer-img" alt="" />
      </div>
    </div>
  </div>

  <partial name="Features/_SplitModal" />
  <partial name="Features/_OknoFixModal" />
  <partial name="Features/_OknoScaleModal" />
  <partial name="Features/_ImageEditModal" />
  <partial name="Features/_VideoEditModal" />
  <partial name="Features/_Split3Modal" />
  <partial name="Features/_CropModal" />
  <div id="helpModal" class="modal" hidden>
    <div class="modal-backdrop" data-close="1"></div>
    <div class="modal-card help-card" role="dialog" aria-modal="true" aria-label="Справка по Jmaka">
      <div class="modal-header">
        <div class="modal-title-wrap">
          <div class="modal-title">Справка по Jmaka</div>
          <div class="modal-sub">
            <span class="modal-subtext">Практическая шпаргалка по функциям, статусам и быстрым действиям.</span>
          </div>
        </div>
        <button id="helpClose" class="modal-x" type="button" aria-label="Закрыть">×</button>
      </div>
      <div class="modal-body help-body">
        <div class="help-intro">
          <p class="help-lead"><strong>Jmaka</strong> — рабочий инструмент для быстрой подготовки изображений и видео в одном окне.</p>
          <div class="help-chip-row">
            <span class="help-chip">RU / EN / ES</span>
            <span class="help-chip">Изображения + видео</span>
            <span class="help-chip">История + автоочистка</span>
          </div>
        </div>

        <div class="help-grid">
          <section class="help-section">
            <h3>Быстрый старт</h3>
            <ul>
              <li>Нажмите на кнопку-дискету, перетащите файлы или вставьте изображение из буфера обмена (Ctrl+V).</li>
              <li>Выберите язык в правом верхнем углу: русский, английский или испанский.</li>
              <li>Клик по строке в таблице делает её активной для всех инструментов.</li>
            </ul>
          </section>

          <section class="help-section">
            <h3>Файлы и таблицы</h3>
            <ul>
              <li>Слева: Original / Crop / размеры 1280, 1920, 2440.</li>
              <li>Справа: история Split, Split3, OknoFix, OknoScale, Edit и Video Edit.</li>
              <li>Любой результат можно открыть, скачать или удалить.</li>
            </ul>
          </section>

          <section class="help-section">
            <h3>Инструменты изображений</h3>
            <ul>
              <li><strong>Crop</strong> — кадрирование исходника (1:1, 2:3, 16:9).</li>
              <li><strong>Split / Split3</strong> — компоновка 2 или 3 изображений в 1280×720 с белыми разделителями.</li>
              <li><strong>OknoFix / OknoScale</strong> — вертикальные карточки с позиционированием и масштабом под шаблон.</li>
              <li><strong>Edit</strong> — тонкая настройка цвета, света, деталей и эффектов с сохранением результата как нового файла.</li>
            </ul>
          </section>

          <section class="help-section">
            <h3>Video Edit</h3>
            <ul>
              <li>Trim с несколькими сегментами, Crop, Rotate, Flip, Speed, Mute и Reset.</li>
              <li>Склейка нескольких оригиналов в один результат: добавление клипов кнопкой «+» в конце таймлайна.</li>
              <li>Для каждого клипа можно задать свои сегменты и свой вертикальный сдвиг в окне превью.</li>
              <li>Позиция по высоте запоминается отдельно для режимов Vidcov и Episod (10/20/30 MB).</li>
              <li>Overlay Upload: загрузка PNG/WebP/JPEG шаблона поверх видео.</li>
              <li>Vidcov режим и быстрый выбор лимита размера (Episod 10/20/30 MB).</li>
              <li>Статусы обработки показывают очередь, прогресс и оставшееся время.</li>
            </ul>
          </section>

          <section class="help-section help-section-wide">
            <h3>Полезные мелочи</h3>
            <ul>
              <li>Старые записи и файлы очищаются автоматически по времени хранения.</li>
              <li>Если обработка завершилась только что, нажмите Refresh в Video Edit или обновите список результатов.</li>
              <li>Кнопка удаления удаляет запись и связанные файлы безвозвратно.</li>
            </ul>
          </section>
        </div>
      </div>
    </div>
  </div>

  <!-- Load ascii-art.js before feature scripts since shared/core depends on window.getRandomAsciiArt -->
  <script src="~/ascii-art.js" asp-append-version="true"></script>
  <script src="~/features/shared/core.js" asp-append-version="true"></script>
  <script src="~/features/split/tool.js" asp-append-version="true"></script>
  <script src="~/features/split3/tool.js" asp-append-version="true"></script>
  <script src="~/features/oknofix/tool.js" asp-append-version="true"></script>
  <script src="~/features/oknoscale/tool.js" asp-append-version="true"></script>
  <script src="~/features/crop/tool.js" asp-append-version="true"></script>
  <script src="~/features/edit/tool.js" asp-append-version="true"></script>
  <script src="~/features/videoedit/tool.js" asp-append-version="true"></script>
</body>
</html>
