  <div id="videoEditModal" class="modal" hidden>
    <div class="modal-backdrop" data-close="1"></div>
    <div class="modal-card video-edit-card" role="dialog" aria-modal="true" aria-label="Video Edit">
      <div class="modal-header">
        <div class="modal-title-wrap">
          <div class="modal-title">Video Edit</div>
          <div class="modal-sub"><span class="modal-subtext">Trim, crop, rotate and size tuning.</span></div>
        </div>
        <button id="videoEditClose" class="modal-x" type="button" aria-label="Закрыть">×</button>
      </div>

      <div class="video-edit-toolbar">
        <div class="video-tool-group">
          <button class="tool-btn" data-tool="trim" type="button" title="Trim">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
              <path d="M3 2l1 1-1 1-1-1 1-1zm5 0l1 1-1 1-1-1 1-1zm5 0l1 1-1 1-1-1 1-1zm-10 5l1 1-1 1-1-1 1-1zm5 0l1 1-1 1-1-1 1-1zm5 0l1 1-1 1-1-1 1-1zm-10 5l1 1-1 1-1-1 1-1zm5 0l1 1-1 1-1-1 1-1zm5 0l1 1-1 1-1-1 1-1z"/>
              <path d="M2 1h3v14H2V1zm9 0h3v14h-3V1z" fill-opacity="0.45"/>
            </svg>
            <span>Trim</span>
          </button>
          <button class="tool-btn" data-tool="crop" type="button" title="Crop">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
              <path d="M11 1h1v3h3v1h-3v6h-1V5H5v6H4v1h6v3h1v-3h4v-1h-4V1z"/>
              <path d="M1 4h3v1H1V4zm0 6h3v1H1v-1z"/>
            </svg>
            <span>Crop</span>
          </button>
          <button class="tool-btn" data-tool="rotate" type="button" title="Rotate">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
              <path d="M8 2a6 6 0 016 6h2A8 8 0 008 0v2zm0 12a6 6 0 01-6-6H0a8 8 0 008 8v-2z"/>
              <path d="M14 8l2-2 2 2h-4z"/>
            </svg>
            <span>Rotate</span>
          </button>
          <button class="tool-btn" data-tool="flip" type="button" title="Flip">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
              <path d="M8 1l3 3H9v8h2l-3 3-3-3h2V4H5l3-3z"/>
            </svg>
            <span>Flip</span>
          </button>
          <button class="tool-btn" data-tool="speed" type="button" title="Speed">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
              <path d="M8 2a6 6 0 100 12A6 6 0 008 2zm0 1a5 5 0 110 10A5 5 0 018 3z"/>
              <path d="M8 5v3h3V7H9V5H8z"/>
            </svg>
            <span>Speed</span>
          </button>
        </div>
        <div class="video-tool-group video-tool-group-right">
          <button id="videoOverlayUploadBtn" class="tool-btn" type="button" title="Upload overlay">Overlay Upload</button>
          <button id="videoOverlayRenameBtn" class="tool-btn" type="button" title="Rename selected overlay">Rename</button>
          <button id="videoOverlayDeleteBtn" class="tool-btn video-overlay-delete-btn" type="button" title="Delete selected overlay" aria-label="Delete selected overlay">×</button>
          <select id="videoOverlaySelect" class="video-overlay-select" aria-label="Overlay template">
            <option value="">No overlay</option>
          </select>
        </div>
      </div>

      <div class="video-helper-text">Use timeline below to select video segments</div>

      <div class="modal-body video-edit-body">
        <section class="video-edit-main">
          <div class="video-preview-wrap">
            <div class="video-preview-stage">
              <video id="videoEditPreview" class="video-preview" playsinline></video>
              <img id="videoOverlayPreview" class="video-overlay-preview" alt="" hidden />
              <div id="videoCropOverlay" class="video-crop-overlay" hidden>
                <div id="videoCropRect" class="video-crop-rect" role="presentation">
                  <span class="crop-handle tl" data-handle="tl"></span>
                  <span class="crop-handle tr" data-handle="tr"></span>
                  <span class="crop-handle bl" data-handle="bl"></span>
                  <span class="crop-handle br" data-handle="br"></span>
                </div>
              </div>
            </div>
          </div>

          <div class="video-timeline">
            <div class="timeline-zoom-row">
              <div class="timeline-zoom-controls">
                <button id="videoTimelineZoomOut" class="btn small" type="button" title="Zoom out">-</button>
                <button id="videoTimelineZoomIn" class="btn small" type="button" title="Zoom in">+</button>
                <button id="videoTimelineZoomFit" class="btn small" type="button" title="Fit">Fit</button>
                <span id="videoTimelineZoomLabel" class="timeline-zoom-label">1.0x</span>
              </div>
              <div class="timeline-zoom-center timeline-clip-controls">
                <div id="videoTimelineClips" class="timeline-clips" aria-label="Выбранные клипы таймлайна"></div>
              </div>
              <div class="timeline-zoom-hint">Колесо: зум, Shift+колесо: панорама</div>
            </div>
            <div class="timeline-strip-wrap">
              <div class="timeline-strip" id="videoTimelineStrip">
                <canvas id="videoTimelineCanvas"></canvas>
                <div id="videoTimelineSegments" class="timeline-segments"></div>
                <div id="videoTimelinePlayhead" class="timeline-playhead"></div>
              </div>
              <div class="timeline-strip-add">
                <button id="videoTimelineAddBtn" class="timeline-add-btn" type="button" title="Добавить видео в конец" aria-label="Добавить видео в конец">+</button>
                <div id="videoTimelineAddMenu" class="timeline-add-menu" hidden></div>
              </div>
            </div>
            <div class="timeline-overview" id="videoTimelineOverview" title="Timeline overview">
              <div class="timeline-overview-window" id="videoTimelineOverviewWindow"></div>
            </div>
            <div class="timeline-meta">
              <div class="timeline-range">IN <span id="videoTrimStartLabel">00:00</span> - OUT <span id="videoTrimEndLabel">00:00</span></div>
              <div class="timeline-help">Drag boundaries to set segment.</div>
              <div class="timeline-segment-controls">
                <button id="videoAddSegment" class="btn small" type="button" title="Добавить сегмент">+ Сегмент</button>
                <button id="videoRemoveSegment" class="btn small" type="button" title="Удалить активный сегмент">- Сегмент</button>
                <span id="videoSegmentsInfo" class="timeline-segments-info">1 сегмент</span>
              </div>
            </div>
          </div>

          <div class="video-edit-controls">
            <div class="video-controls-left">
              <button id="videoPlayToggle" class="btn icon-btn" type="button">▶</button>
              <div class="video-timecode"><span id="videoCurrentTime">00:00</span> / <span id="videoDuration">00:00</span></div>
            </div>
            <div class="video-controls-right">
              <div class="video-tool-panels">
                <div class="video-tool-panel" data-tool-panel="trim"></div>
                <div class="video-tool-panel" data-tool-panel="crop" hidden>
                  <div class="panel-controls">
                    <button class="btn small video-crop-ratio-btn" type="button" data-crop-ratio="16:9">16:9</button>
                    <button class="btn small video-crop-ratio-btn" type="button" data-crop-ratio="1:1">1:1</button>
                    <button class="btn small video-crop-ratio-btn" type="button" data-crop-ratio="9:16">9:16</button>
                  </div>
                </div>
                <div class="video-tool-panel" data-tool-panel="rotate" hidden>
                  <div class="panel-controls">
                    <button id="videoRotateCw" class="btn small" type="button">↻ 90°</button>
                    <button id="videoRotateCcw" class="btn small" type="button">↺ 90°</button>
                    <button id="videoRotateReset" class="btn small" type="button">Reset</button>
                  </div>
                </div>
                <div class="video-tool-panel" data-tool-panel="flip" hidden>
                  <div class="panel-controls">
                    <button id="videoFlipH" class="btn small" type="button">↔ Flip H</button>
                    <button id="videoFlipV" class="btn small" type="button">↕ Flip V</button>
                    <button id="videoFlipReset" class="btn small" type="button">Reset</button>
                  </div>
                </div>
                <div class="video-tool-panel" data-tool-panel="speed" hidden>
                  <div class="panel-controls">
                    <label class="video-speed-label">Speed <span id="videoSpeedValue">1.0x</span>
                      <input id="videoSpeedRange" type="range" min="0.25" max="2" step="0.25" value="1" />
                    </label>
                  </div>
                </div>
              </div>
              <label class="btn video-bottom-mute" title="Mute / Unmute">
                <input id="videoMuteAudio" type="checkbox" hidden />
                <span id="videoMuteLabel">Mute</span>
              </label>
              <button id="videoModeVidcov" class="btn video-mode-btn" type="button">Vidcov</button>
              <div class="video-episod-group" aria-label="Episod size">
                <span class="video-episod-label">Episod:</span>
                <button class="btn video-size-btn is-active" type="button" data-size-limit="10mb">10 MB</button>
                <button class="btn video-size-btn" type="button" data-size-limit="20mb">20 MB</button>
                <button class="btn video-size-btn" type="button" data-size-limit="30mb">30 MB</button>
              </div>
            </div>
          </div>

        </section>
        <aside class="video-edit-sidebar">
          <div class="sidebar-libraries">
            <div class="sidebar-section">
              <div class="sidebar-header">
                <span>Originals</span>
                <button id="videoUploadBtn" class="btn small" type="button">Upload</button>
                <button id="videoHistoryRefresh" class="btn small" type="button">Refresh</button>
              </div>
              <div id="videoOriginalsList" class="video-list"></div>
            </div>
            <div class="sidebar-section video-column">
              <div class="sidebar-header">
                <span>Processed</span>
                <button id="videoProcessedRefresh" class="btn small" type="button">Refresh</button>
              </div>
              <div id="videoProcessedList" class="video-list"></div>
            </div>
          </div>
        </aside>
        <input id="videoUploadInput" type="file" hidden />
        <input id="videoOverlayInput" type="file" accept="image/png,image/webp,image/jpeg" hidden />
        <div id="videoProcessingOverlay" class="video-processing-overlay" hidden>Processing…</div>
      </div>
      <div class="modal-footer video-footer">
        <div class="video-footer-left">
          <button id="videoResetBtn" class="btn video-bottom-reset" type="button">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M3 12a9 9 0 1 0 3-6.708" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M3 4v4h4" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span>Reset</span>
          </button>
        </div>
        <div id="videoStatusLine" class="video-status-line" aria-live="polite">
          <div id="videoStatusText" class="video-status-text">Ready</div>
          <div class="video-status-track"><div id="videoStatusBar" class="video-status-bar"></div></div>
        </div>
        <div class="video-footer-right">
          <button id="videoEditSave" class="btn primary video-process-btn" type="button" disabled>Process</button>
          <input id="videoTargetSize" type="number" min="0.1" max="2048" step="0.1" value="10" hidden />
          <button id="videoEditCancel" class="btn" type="button" hidden>Close</button>
        </div>
      </div>
    </div>
  </div>
